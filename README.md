## go-mapper-gen
A type-safe code generator for Go that automates the mapping between different struct types (e.g., Domain Entities to
Database Models). Powered by Pkl for a modern, schema-driven configuration experience.

### üí° Why go-mapper-gen?

Manually writing `ToEntity` and `FromEntity` functions is tedious and error-prone. This tool generates those mappings
for you, handling basic types automatically and allowing custom logic for complex transformations.

- **Flexible Mapping Modes**: generate standalone conversion functions or group them as methods of an interface.
- **Pkl-Powered Config**: use [Apple‚Äôs Pkl language](https://pkl-lang.org) for configuration
  with full IDE auto-suggestion, validation, and strong typing.
- **Custom Conversions**: Define custom function calls for fields that require more than a simple type cast.
- **Type Safety**: The generator analyzes your Go source types to ensure mappings are valid at generation time, not runtime.


### üõ† Features in Action

Firstly, let set up a project which uses [sqlc](https://sqlc.dev) and pgtype

```go.mod
module github.com/toniphan21/go-mapper-gen/basic

go 1.25

require github.com/jackc/pgx/v5 v5.7.6
```

the `go.sum` file is

```go.sum
github.com/jackc/pgx/v5 v5.7.6 h1:rWQc5FwZSPX58r1OQmkuaNicxdmExaEz5A2DO2hUuTk=
github.com/jackc/pgx/v5 v5.7.6/go.mod h1:aruU7o91Tc2q2cFp5h4uP3f6ztExVpyVv88Xl/8Vl8M=
```

Given that you have an entity located in your `/domain`:

```go
// file: domain/entity.go
//go:generate go run github.com/toniphan21/go-mapper-gen/cmd/generator

package domain

type User struct {
	ID   	  string
	FirstName string
	LastName  string
	Email     string
	Password  *string
}
```

and another struct perhaps generated from your database using tool such as [sqlc](https://sqlc.dev)

```go
// file: db/models.go

package db

import "github.com/jackc/pgx/v5/pgtype"

type User struct {
	ID        string
	Email     string
	FirstName string
	LastName  string
	Password  pgtype.Text
}

```

#### Minimal configuration

With simple pkl configuration like this

```pkl
// file: mapper.pkl
amends "https://github.com/toniphan21/gmg-lib/releases/download/v0.1.0/Config.pkl"

packages {
	["github.com/toniphan21/go-mapper-gen/basic/db"] {
		source_pkg = "github.com/toniphan21/go-mapper-gen/basic/domain"
		structs {
			["User"] { source_struct_name = "User" }
		}
	}
}

```

the generated code in default `mode = "types"` is

```go
// golden-file: db/gen_mapper.go
// Code generated by github.com/toniphan21/go-mapper-gen - test, DO NOT EDIT.

package db

import (
	pgtype "github.com/jackc/pgx/v5/pgtype"
	domain "github.com/toniphan21/go-mapper-gen/basic/domain"
)

type iMapper interface {
	// ToUser converts a domain.User value into a User value.
	ToUser(in domain.User) User

	// FromUser converts a User value into a domain.User value.
	FromUser(in User) domain.User
}

func new_iMapper() iMapper {
	return &iMapperImpl{}
}

type iMapperImpl struct{}

func (m *iMapperImpl) ToUser(in domain.User) User {
	var out User

	out.ID = in.ID
	out.Email = in.Email
	out.FirstName = in.FirstName
	out.LastName = in.LastName
	if in.Password != nil {
		out.Password = pgtype.Text{
			String: *in.Password,
			Valid:  true,
		}
	}

	return out
}

func (m *iMapperImpl) FromUser(in User) domain.User {
	var out domain.User

	out.ID = in.ID
	out.FirstName = in.FirstName
	out.LastName = in.LastName
	out.Email = in.Email
	if in.Password.Valid {
		out.Password = &in.Password.String
	}

	return out
}

var _ iMapper = (*iMapperImpl)(nil)
```

the default interface/implementation and constructor name are unexported because `go-mapper-gen` doesn't
want to pollute your source code. You can use it via composition like this

```go
// file: domain/mapper.go

var mapper = new_iMapper()

func test() {
	// mapper.ToUser(...)
}

// or

type Mapper interface {
	iMapper
}

```

If you want to rename an interface/implementation, use `interface_name = ...`. Please check out `Config.pkl` file to see
all the options.

#### Functional style

You can switch to functions mode, `go-mapper-gen` will generate package level functions only.

```pkl
// file: mapper.pkl
amends "https://github.com/toniphan21/gmg-lib/releases/download/v0.1.0/Config.pkl"

packages {
  	["github.com/toniphan21/go-mapper-gen/basic/db"] { 
		mode = "functions"
		source_pkg = "github.com/toniphan21/go-mapper-gen/basic/domain"
		structs {
		  	["User"] { source_struct_name = "User" }
		}
	}
}
```

generated code in `mode = "functions"` is

```go
// golden-file: db/gen_mapper.go
// Code generated by github.com/toniphan21/go-mapper-gen - test, DO NOT EDIT.

package db

import (
	pgtype "github.com/jackc/pgx/v5/pgtype"
	domain "github.com/toniphan21/go-mapper-gen/basic/domain"
)

// ToUser converts a domain.User value into a User value.
func ToUser(in domain.User) User {
	var out User

	out.ID = in.ID
	out.Email = in.Email
	out.FirstName = in.FirstName
	out.LastName = in.LastName
	if in.Password != nil {
		out.Password = pgtype.Text{
			String: *in.Password,
			Valid:  true,
		}
	}

	return out
}

// FromUser converts a User value into a domain.User value.
func FromUser(in User) domain.User {
	var out domain.User

	out.ID = in.ID
	out.FirstName = in.FirstName
	out.LastName = in.LastName
	out.Email = in.Email
	if in.Password.Valid {
		out.Password = &in.Password.String
	}

	return out
}
```

### ü§ù Contributing

PRs are welcome! Please see our Contributing Guide for details on how to run tests and submit high-quality pull
requests.

### üìÑ License

Distributed under the MIT License.

### ‚òï Support

Like the project? [Buy me a coffee](https://buymeacoffee.com/toniphan21)
