amends ".../Config.pkl"

import "../set.pkl"

all {
  output { file_name = "mycode.go" }
}

local function package(path: String): String = "a" + path

converter {
  built_in {
    enable_type_to_pointer = true

    library {
      enable_pgtype = false
    }
  }

  functions {
    "github.com/toniphan21/pgx-mapper.NilableStringToText"
    "github.com/toniphan21/pgx-mapper.TextToNilableString"
  }
}

packages {
  ["github.com/toniphan21/go-mapper-gen"] {
    mode = "functions"

    source_pkg = "{CurrentPackage}"
    decorator_noop_name = ""

    generate_source_from_target = false

    structs {
      ["Login"] {}

      ["LoginParams"] {
        source_struct_name = "Login"
        fields {
          // use listing
          target {
            ["Name"] = set.nil_if_zero()
            ["Password"] = set.via_function("TextToNilableString")
          }

          // use listing<map>
          source {
            Map("Name", set.nil_if_zero())

            Map("Password", set.via_function(""))
          }
        }
      }
    }
  }

  ["github.com/toniphan21/plural"] {
    priorities {
      [0] {
        source_pkg = "{CurrentPackage}"

        structs {
          ["LoginParams"] {
            source_struct_name = "Login"

            fields {
              target { ["Name"] = set.nil_if_zero() }
            }
          }
        }
      }

      [1] {
        source_pkg = "{CurrentPackage}"

        structs {
          ["LoginParams"] {
            target_struct_name = "LoginParams"
            source_struct_name = "Login"
            source_to_target_function_name = ""
            source_from_target_function_name = ""
            pointer = "none"
            generate_source_to_target = true
          }
        }
      }
    }
  }

  ["github.com/toniphan21/custom-field-mapping"] {
    source_pkg = ""

    structs {
      ["LoginParams"] {
        source_struct_name = "Login"

        fields {
          match = "ignore-case"
          map {
            ["Attribute"] = "Attr"
            ["Auth"] = "Authenticate"
          }
        }
      }

    }
  }

}